<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة الاشتراكات | Subscription Management System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Inter:wght@300;400;600;700;800&display=swap');
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cairo', 'Inter', sans-serif;
            background: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 24px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 48px;
            height: 48px;
        }
        
        .logo-text h1 {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 4px;
        }
        
        .logo-text p {
            font-size: 13px;
            opacity: 0.9;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary {
            background: white;
            color: var(--primary);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--gray-300);
            color: var(--gray-700);
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin: 32px 0;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-left: 4px solid;
            transition: all 0.2s;
        }
        
        .stat-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-4px);
        }
        
        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            padding: 12px;
            border-radius: 10px;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 800;
            line-height: 1;
        }
        
        .stat-label {
            color: var(--gray-600);
            font-size: 14px;
            font-weight: 600;
            margin-top: 8px;
        }
        
        /* Search and Filter */
        .controls {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .controls-content {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .input {
            padding: 12px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.2s;
            flex: 1;
            min-width: 200px;
        }
        
        .input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        /* Client Cards */
        .clients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .client-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .client-card:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            transform: translateY(-4px);
            border-color: var(--primary);
        }
        
        .client-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .client-name {
            font-size: 20px;
            font-weight: 700;
            color: var(--gray-900);
        }
        
        .device-count {
            background: var(--gray-100);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            color: var(--gray-700);
        }
        
        .client-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 16px;
        }
        
        .client-stat {
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            background: var(--gray-50);
        }
        
        .client-stat-value {
            font-size: 24px;
            font-weight: 800;
            line-height: 1;
        }
        
        .client-stat-label {
            font-size: 11px;
            color: var(--gray-600);
            margin-top: 4px;
            font-weight: 600;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.2s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal {
            background: white;
            border-radius: 16px;
            max-width: 1200px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray-500);
            padding: 8px;
            line-height: 1;
        }
        
        .modal-close:hover {
            color: var(--gray-900);
        }
        
        .modal-body {
            padding: 24px;
        }
        
        /* Device Table */
        .devices-grid {
            display: grid;
            gap: 16px;
        }
        
        .device-card {
            background: var(--gray-50);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid;
            transition: all 0.2s;
        }
        
        .device-card:hover {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .device-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .device-name {
            font-size: 16px;
            font-weight: 700;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .device-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            font-size: 13px;
        }
        
        .device-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .device-actions {
            margin-top: 16px;
            display: flex;
            gap: 8px;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }
        
        /* Form */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 14px;
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .badge-primary {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        
        .empty-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            opacity: 0.3;
        }
        
        .empty-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--gray-400);
            margin-bottom: 8px;
        }
        
        .empty-text {
            color: var(--gray-500);
        }
        
        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Language Switcher */
        .lang-switch {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            overflow: hidden;
            z-index: 100;
        }
        
        .lang-btn {
            padding: 8px 16px;
            border: none;
            background: white;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .lang-btn.active {
            background: var(--primary);
            color: white;
        }
        
        /* Login */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }
        
        .login-box {
            background: white;
            border-radius: 16px;
            padding: 48px;
            max-width: 420px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .login-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
        }
        
        .login-title {
            font-size: 28px;
            font-weight: 800;
            text-align: center;
            margin-bottom: 8px;
        }
        
        .login-subtitle {
            text-align: center;
            color: var(--gray-600);
            margin-bottom: 32px;
        }
        
        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid var(--danger);
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .clients-grid {
                grid-template-columns: 1fr;
            }
            
            .login-box {
                padding: 32px 24px;
            }
        }
        
        [dir="ltr"] .client-card,
        [dir="ltr"] .device-card,
        [dir="ltr"] .stat-card {
            border-left: none;
            border-right: 4px solid;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Custom SVG Icons
        const Icons = {
            Logo: () => (
                <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="64" height="64" rx="12" fill="url(#grad1)"/>
                    <path d="M20 24h24v4H20zm0 8h24v4H20zm0 8h16v4H20z" fill="white"/>
                    <circle cx="44" cy="44" r="8" fill="white" opacity="0.3"/>
                    <defs>
                        <linearGradient id="grad1" x1="0" y1="0" x2="64" y2="64">
                            <stop offset="0%" stopColor="#2563eb"/>
                            <stop offset="100%" stopColor="#1e40af"/>
                        </linearGradient>
                    </defs>
                </svg>
            ),
            Users: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
            ),
            CheckCircle: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
            ),
            AlertCircle: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
            ),
            XCircle: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="15" y1="9" x2="9" y2="15"/>
                    <line x1="9" y1="9" x2="15" y2="15"/>
                </svg>
            ),
            Monitor: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                    <line x1="8" y1="21" x2="16" y2="21"/>
                    <line x1="12" y1="17" x2="12" y2="21"/>
                </svg>
            ),
            Plus: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
            ),
            Edit: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
            ),
            Trash: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
            ),
            Refresh: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <polyline points="23 4 23 10 17 10"/>
                    <polyline points="1 20 1 14 7 14"/>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                </svg>
            ),
            Search: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
            ),
            Calendar: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
            ),
            Clock: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                </svg>
            ),
            LogOut: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
            ),
            X: ({ color = "currentColor" }) => (
                <svg viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            )
        };

        // Storage utility
        const storage = {
            get: (key) => {
                try {
                    const value = localStorage.getItem(key);
                    return value ? { key, value } : null;
                } catch {
                    return null;
                }
            },
            set: (key, value) => {
                try {
                    localStorage.setItem(key, value);
                    return { key, value };
                } catch {
                    return null;
                }
            },
            delete: (key) => {
                try {
                    localStorage.removeItem(key);
                    return { key, deleted: true };
                } catch {
                    return null;
                }
            }
        };

        // Translations
        const translations = {
            ar: {
                appTitle: 'نظام إدارة الاشتراكات',
                appSubtitle: 'إدارة احترافية لاشتراكات العملاء',
                totalClients: 'إجمالي العملاء',
                activeDevices: 'أجهزة نشطة',
                expiringSoon: 'تنتهي قريباً',
                expired: 'منتهية',
                addClient: 'إضافة عميل',
                searchPlaceholder: 'البحث عن عميل...',
                devices: 'جهاز',
                active: 'نشط',
                expiring: 'قريب',
                clientDetails: 'تفاصيل العميل',
                addDevice: 'إضافة جهاز',
                deviceName: 'اسم الجهاز',
                duration: 'المدة',
                notes: 'ملاحظات',
                startDate: 'تاريخ البداية',
                endDate: 'تاريخ الانتهاء',
                remaining: 'المتبقي',
                days: 'يوم',
                edit: 'تعديل',
                delete: 'حذف',
                renew: 'تجديد',
                save: 'حفظ',
                cancel: 'إلغاء',
                clientName: 'اسم العميل',
                oneDay: 'يوم واحد',
                oneWeek: 'أسبوع',
                oneMonth: 'شهر',
                custom: 'مخصص',
                login: 'تسجيل الدخول',
                username: 'اسم المستخدم',
                password: 'كلمة المرور',
                logout: 'تسجيل الخروج',
                admin: 'مدير',
                viewer: 'مشاهد',
                noClients: 'لا يوجد عملاء',
                addFirstClient: 'ابدأ بإضافة عميلك الأول',
                loading: 'جاري التحميل...',
                viewOnly: 'وضع المشاهدة فقط',
                noDevices: 'لا توجد أجهزة'
            },
            en: {
                appTitle: 'Subscription Management',
                appSubtitle: 'Professional Client Subscription Management',
                totalClients: 'Total Clients',
                activeDevices: 'Active Devices',
                expiringSoon: 'Expiring Soon',
                expired: 'Expired',
                addClient: 'Add Client',
                searchPlaceholder: 'Search clients...',
                devices: 'Devices',
                active: 'Active',
                expiring: 'Soon',
                clientDetails: 'Client Details',
                addDevice: 'Add Device',
                deviceName: 'Device Name',
                duration: 'Duration',
                notes: 'Notes',
                startDate: 'Start Date',
                endDate: 'End Date',
                remaining: 'Remaining',
                days: 'days',
                edit: 'Edit',
                delete: 'Delete',
                renew: 'Renew',
                save: 'Save',
                cancel: 'Cancel',
                clientName: 'Client Name',
                oneDay: 'One Day',
                oneWeek: 'One Week',
                oneMonth: 'One Month',
                custom: 'Custom',
                login: 'Login',
                username: 'Username',
                password: 'Password',
                logout: 'Logout',
                admin: 'Admin',
                viewer: 'Viewer',
                noClients: 'No Clients',
                addFirstClient: 'Start by adding your first client',
                loading: 'Loading...',
                viewOnly: 'View Only Mode',
                noDevices: 'No Devices'
            }
        };

        function App() {
            const [lang, setLang] = useState('ar');
            const [user, setUser] = useState(null);
            const [clients, setClients] = useState([]);
            const [selectedClient, setSelectedClient] = useState(null);
            const [showClientModal, setShowClientModal] = useState(false);
            const [showDeviceModal, setShowDeviceModal] = useState(false);
            const [showLogin, setShowLogin] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');
            const [loading, setLoading] = useState(true);
            const [formData, setFormData] = useState({});

            const t = translations[lang];
            const ADMIN = { username: 'M7-511', password: 'M12m12m12' };

            useEffect(() => {
                const savedUser = storage.get('sms_user');
                if (savedUser) {
                    setUser(JSON.parse(savedUser.value));
                    setShowLogin(false);
                }
                loadClients();
                setLoading(false);
            }, []);

            const loadClients = () => {
                const data = storage.get('sms_clients');
                if (data) {
                    setClients(JSON.parse(data.value));
                }
            };

            const saveClients = (data) => {
                storage.set('sms_clients', JSON.stringify(data));
                setClients(data);
            };

            const handleLogin = (e) => {
                e.preventDefault();
                const username = e.target.username.value;
                const password = e.target.password.value;
                
                if (username === ADMIN.username && password === ADMIN.password) {
                    const userData = { username, role: 'admin' };
                    storage.set('sms_user', JSON.stringify(userData));
                    setUser(userData);
                    setShowLogin(false);
                }
            };

            const handleLogout = () => {
                storage.delete('sms_user');
                setUser(null);
                setShowLogin(true);
            };

            const getDeviceStatus = (endDate) => {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const end = new Date(endDate);
                end.setHours(0, 0, 0, 0);
                const diff = Math.ceil((end - today) / (1000 * 60 * 60 * 24));
                
                if (diff < 0) return { status: 'expired', days: Math.abs(diff), color: 'var(--danger)' };
                if (diff <= 2) return { status: 'expiring', days: diff, color: 'var(--warning)' };
                return { status: 'active', days: diff, color: 'var(--success)' };
            };

            const getClientStats = (client) => {
                const devices = client.devices || [];
                const active = devices.filter(d => getDeviceStatus(d.endDate).status === 'active').length;
                const expiring = devices.filter(d => getDeviceStatus(d.endDate).status === 'expiring').length;
                const expired = devices.filter(d => getDeviceStatus(d.endDate).status === 'expired').length;
                return { total: devices.length, active, expiring, expired };
            };

            const getGlobalStats = () => {
                const stats = { clients: clients.length, active: 0, expiring: 0, expired: 0 };
                clients.forEach(client => {
                    const cs = getClientStats(client);
                    stats.active += cs.active;
                    stats.expiring += cs.expiring;
                    stats.expired += cs.expired;
                });
                return stats;
            };

            const handleAddClient = (e) => {
                e.preventDefault();
                const name = e.target.clientName.value;
                const newClient = {
                    id: Date.now(),
                    name,
                    devices: [],
                    createdAt: new Date().toISOString()
                };
                saveClients([...clients, newClient]);
                setShowClientModal(false);
            };

            const handleAddDevice = (e) => {
                e.preventDefault();
                const name = e.target.deviceName.value;
                const durationType = e.target.duration.value;
                const customDays = e.target.customDays?.value;
                const notes = e.target.notes.value;
                
                let days = durationType === 'custom' ? customDays : durationType;
                const startDate = new Date().toISOString().split('T')[0];
                const endDate = new Date(Date.now() + days * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                
                const newDevice = {
                    id: Date.now(),
                    name,
                    startDate,
                    endDate,
                    duration: parseInt(days),
                    notes,
                    createdAt: new Date().toISOString()
                };
                
                const updated = clients.map(c => 
                    c.id === selectedClient.id 
                        ? { ...c, devices: [...(c.devices || []), newDevice] }
                        : c
                );
                saveClients(updated);
                setSelectedClient({ ...selectedClient, devices: [...(selectedClient.devices || []), newDevice] });
                setShowDeviceModal(false);
            };

            const handleDeleteDevice = (deviceId) => {
                if (!confirm('هل أنت متأكد من الحذف؟')) return;
                const updated = clients.map(c => 
                    c.id === selectedClient.id 
                        ? { ...c, devices: c.devices.filter(d => d.id !== deviceId) }
                        : c
                );
                saveClients(updated);
                setSelectedClient({ ...selectedClient, devices: selectedClient.devices.filter(d => d.id !== deviceId) });
            };

            const handleRenewDevice = (deviceId) => {
                const device = selectedClient.devices.find(d => d.id === deviceId);
                const startDate = new Date().toISOString().split('T')[0];
                const endDate = new Date(Date.now() + device.duration * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                
                const updated = clients.map(c => 
                    c.id === selectedClient.id 
                        ? { 
                            ...c, 
                            devices: c.devices.map(d => 
                                d.id === deviceId ? { ...d, startDate, endDate } : d
                            )
                        }
                        : c
                );
                saveClients(updated);
                setSelectedClient({
                    ...selectedClient,
                    devices: selectedClient.devices.map(d => 
                        d.id === deviceId ? { ...d, startDate, endDate } : d
                    )
                });
            };

            const filteredClients = clients.filter(c => 
                c.name.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const stats = getGlobalStats();
            const isAdmin = user?.role === 'admin';

            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                    </div>
                );
            }

            if (showLogin) {
                return (
                    <div className="login-container">
                        <div className="lang-switch">
                            <button className={`lang-btn ${lang === 'ar' ? 'active' : ''}`} onClick={() => setLang('ar')}>
                                عربي
                            </button>
                            <button className={`lang-btn ${lang === 'en' ? 'active' : ''}`} onClick={() => setLang('en')}>
                                English
                            </button>
                        </div>
                        <div className="login-box">
                            <div className="login-logo">
                                <Icons.Logo />
                            </div>
                            <h1 className="login-title">{t.login}</h1>
                            <p className="login-subtitle">{t.appSubtitle}</p>
                            <form onSubmit={handleLogin}>
                                <div className="form-group">
                                    <label className="form-label">{t.username}</label>
                                    <input name="username" className="input" required />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">{t.password}</label>
                                    <input name="password" type="password" className="input" required />
                                </div>
                                <button type="submit" className="btn btn-primary" style={{width: '100%'}}>
                                    {t.login}
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div dir={lang === 'ar' ? 'rtl' : 'ltr'}>
                    <div className="lang-switch">
                        <button className={`lang-btn ${lang === 'ar' ? 'active' : ''}`} onClick={() => setLang('ar')}>
                            عربي
                        </button>
                        <button className={`lang-btn ${lang === 'en' ? 'active' : ''}`} onClick={() => setLang('en')}>
                            English
                        </button>
                    </div>

                    <header className="header">
                        <div className="container">
                            <div className="header-content">
                                <div className="logo">
                                    <div className="logo-icon">
                                        <Icons.Logo />
                                    </div>
                                    <div className="logo-text">
                                        <h1>{t.appTitle}</h1>
                                        <p>{t.appSubtitle}</p>
                                    </div>
                                </div>
                                <div className="header-actions">
                                    <span className="badge badge-primary">{user.username}</span>
                                    <button className="btn btn-secondary" onClick={handleLogout}>
                                        <div style={{width: '18px', height: '18px'}}>
                                            <Icons.LogOut color="white" />
                                        </div>
                                        {t.logout}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="container">
                        <div className="stats-grid">
                            <div className="stat-card" style={{borderLeftColor: 'var(--primary)'}}>
                                <div className="stat-card-header">
                                    <div>
                                        <div className="stat-value" style={{color: 'var(--primary)'}}>{stats.clients}</div>
                                        <div className="stat-label">{t.totalClients}</div>
                                    </div>
                                    <div className="stat-icon" style={{background: 'rgba(37, 99, 235, 0.1)'}}>
                                        <Icons.Users color="var(--primary)" />
                                    </div>
                                </div>
                            </div>

                            <div className="stat-card" style={{borderLeftColor: 'var(--success)'}}>
                                <div className="stat-card-header">
                                    <div>
                                        <div className="stat-value" style={{color: 'var(--success)'}}>{stats.active}</div>
                                        <div className="stat-label">{t.activeDevices}</div>
                                    </div>
                                    <div className="stat-icon" style={{background: 'rgba(16, 185, 129, 0.1)'}}>
                                        <Icons.CheckCircle color="var(--success)" />
                                    </div>
                                </div>
                            </div>

                            <div className="stat-card" style={{borderLeftColor: 'var(--warning)'}}>
                                <div className="stat-card-header">
                                    <div>
                                        <div className="stat-value" style={{color: 'var(--warning)'}}>{stats.expiring}</div>
                                        <div className="stat-label">{t.expiringSoon}</div>
                                    </div>
                                    <div className="stat-icon" style={{background: 'rgba(245, 158, 11, 0.1)'}}>
                                        <Icons.AlertCircle color="var(--warning)" />
                                    </div>
                                </div>
                            </div>

                            <div className="stat-card" style={{borderLeftColor: 'var(--danger)'}}>
                                <div className="stat-card-header">
                                    <div>
                                        <div className="stat-value" style={{color: 'var(--danger)'}}>{stats.expired}</div>
                                        <div className="stat-label">{t.expired}</div>
                                    </div>
                                    <div className="stat-icon" style={{background: 'rgba(239, 68, 68, 0.1)'}}>
                                        <Icons.XCircle color="var(--danger)" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="controls">
                            <div className="controls-content">
                                {isAdmin && (
                                    <button className="btn btn-primary" onClick={() => setShowClientModal(true)}>
                                        <div style={{width: '18px', height: '18px'}}>
                                            <Icons.Plus />
                                        </div>
                                        {t.addClient}
                                    </button>
                                )}
                                <div style={{position: 'relative', flex: 1}}>
                                    <input 
                                        className="input" 
                                        placeholder={t.searchPlaceholder}
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                </div>
                            </div>
                        </div>

                        {filteredClients.length === 0 ? (
                            <div className="empty-state">
                                <div className="empty-icon">
                                    <Icons.Users color="var(--gray-300)" />
                                </div>
                                <h3 className="empty-title">{t.noClients}</h3>
                                <p className="empty-text">{t.addFirstClient}</p>
                            </div>
                        ) : (
                            <div className="clients-grid">
                                {filteredClients.map(client => {
                                    const cs = getClientStats(client);
                                    return (
                                        <div key={client.id} className="client-card" onClick={() => setSelectedClient(client)}>
                                            <div className="client-header">
                                                <h3 className="client-name">{client.name}</h3>
                                                <span className="device-count">{cs.total} {t.devices}</span>
                                            </div>
                                            <div className="client-stats">
                                                <div className="client-stat" style={{background: 'rgba(16, 185, 129, 0.1)'}}>
                                                    <div className="client-stat-value" style={{color: 'var(--success)'}}>{cs.active}</div>
                                                    <div className="client-stat-label">{t.active}</div>
                                                </div>
                                                <div className="client-stat" style={{background: 'rgba(245, 158, 11, 0.1)'}}>
                                                    <div className="client-stat-value" style={{color: 'var(--warning)'}}>{cs.expiring}</div>
                                                    <div className="client-stat-label">{t.expiring}</div>
                                                </div>
                                                <div className="client-stat" style={{background: 'rgba(239, 68, 68, 0.1)'}}>
                                                    <div className="client-stat-value" style={{color: 'var(--danger)'}}>{cs.expired}</div>
                                                    <div className="client-stat-label">{t.expired}</div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </main>

                    {selectedClient && (
                        <div className="modal-overlay" onClick={() => setSelectedClient(null)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2 className="modal-title">{selectedClient.name}</h2>
                                    <button className="modal-close" onClick={() => setSelectedClient(null)}>
                                        <Icons.X />
                                    </button>
                                </div>
                                <div className="modal-body">
                                    {isAdmin && (
                                        <button className="btn btn-primary" onClick={() => setShowDeviceModal(true)} style={{marginBottom: '20px'}}>
                                            <div style={{width: '18px', height: '18px'}}>
                                                <Icons.Plus />
                                            </div>
                                            {t.addDevice}
                                        </button>
                                    )}
                                    
                                    {!selectedClient.devices || selectedClient.devices.length === 0 ? (
                                        <div className="empty-state">
                                            <div className="empty-icon">
                                                <Icons.Monitor color="var(--gray-300)" />
                                            </div>
                                            <h3 className="empty-title">{t.noDevices}</h3>
                                        </div>
                                    ) : (
                                        <div className="devices-grid">
                                            {selectedClient.devices.map(device => {
                                                const status = getDeviceStatus(device.endDate);
                                                return (
                                                    <div key={device.id} className="device-card" style={{borderLeftColor: status.color}}>
                                                        <div className="device-header">
                                                            <h4 className="device-name">{device.name}</h4>
                                                            <span className="status-badge" style={{
                                                                background: status.color + '20',
                                                                color: status.color
                                                            }}>
                                                                {status.status === 'active' ? t.active : status.status === 'expiring' ? t.expiring : t.expired}
                                                            </span>
                                                        </div>
                                                        <div className="device-info">
                                                            <div className="device-info-item">
                                                                <div style={{width: '16px', height: '16px'}}>
                                                                    <Icons.Calendar color="var(--gray-500)" />
                                                                </div>
                                                                <span>{t.startDate}: {device.startDate}</span>
                                                            </div>
                                                            <div className="device-info-item">
                                                                <div style={{width: '16px', height: '16px'}}>
                                                                    <Icons.Calendar color="var(--gray-500)" />
                                                                </div>
                                                                <span>{t.endDate}: {device.endDate}</span>
                                                            </div>
                                                            <div className="device-info-item">
                                                                <div style={{width: '16px', height: '16px'}}>
                                                                    <Icons.Clock color="var(--gray-500)" />
                                                                </div>
                                                                <span style={{color: status.color, fontWeight: 700}}>
                                                                    {t.remaining}: {status.days} {t.days}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        {device.notes && (
                                                            <div style={{marginTop: '12px', padding: '8px', background: 'var(--gray-100)', borderRadius: '6px', fontSize: '13px'}}>
                                                                {device.notes}
                                                            </div>
                                                        )}
                                                        {isAdmin && (
                                                            <div className="device-actions">
                                                                <button className="btn btn-success btn-small" onClick={() => handleRenewDevice(device.id)}>
                                                                    <div style={{width: '16px', height: '16px'}}>
                                                                        <Icons.Refresh />
                                                                    </div>
                                                                    {t.renew}
                                                                </button>
                                                                <button className="btn btn-danger btn-small" onClick={() => handleDeleteDevice(device.id)}>
                                                                    <div style={{width: '16px', height: '16px'}}>
                                                                        <Icons.Trash />
                                                                    </div>
                                                                    {t.delete}
                                                                </button>
                                                            </div>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {showClientModal && (
                        <div className="modal-overlay" onClick={() => setShowClientModal(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()} style={{maxWidth: '500px'}}>
                                <div className="modal-header">
                                    <h2 className="modal-title">{t.addClient}</h2>
                                    <button className="modal-close" onClick={() => setShowClientModal(false)}>
                                        <Icons.X />
                                    </button>
                                </div>
                                <div className="modal-body">
                                    <form onSubmit={handleAddClient}>
                                        <div className="form-group">
                                            <label className="form-label">{t.clientName}</label>
                                            <input name="clientName" className="input" required />
                                        </div>
                                        <div className="form-actions">
                                            <button type="submit" className="btn btn-success">{t.save}</button>
                                            <button type="button" className="btn btn-outline" onClick={() => setShowClientModal(false)}>{t.cancel}</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )}

                    {showDeviceModal && (
                        <div className="modal-overlay" onClick={() => setShowDeviceModal(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()} style={{maxWidth: '600px'}}>
                                <div className="modal-header">
                                    <h2 className="modal-title">{t.addDevice}</h2>
                                    <button className="modal-close" onClick={() => setShowDeviceModal(false)}>
                                        <Icons.X />
                                    </button>
                                </div>
                                <div className="modal-body">
                                    <form onSubmit={handleAddDevice}>
                                        <div className="form-grid">
                                            <div className="form-group">
                                                <label className="form-label">{t.deviceName}</label>
                                                <input name="deviceName" className="input" required />
                                            </div>
                                            <div className="form-group">
                                                <label className="form-label">{t.duration}</label>
                                                <select name="duration" className="input" onChange={(e) => setFormData({...formData, durationType: e.target.value})}>
                                                    <option value="1">{t.oneDay}</option>
                                                    <option value="7">{t.oneWeek}</option>
                                                    <option value="30">{t.oneMonth}</option>
                                                    <option value="custom">{t.custom}</option>
                                                </select>
                                            </div>
                                        </div>
                                        {formData.durationType === 'custom' && (
                                            <div className="form-group">
                                                <label className="form-label">{t.days}</label>
                                                <input name="customDays" type="number" min="1" className="input" required />
                                            </div>
                                        )}
                                        <div className="form-group">
                                            <label className="form-label">{t.notes}</label>
                                            <textarea name="notes" className="input" rows="3"></textarea>
                                        </div>
                                        <div className="form-actions">
                                            <button type="submit" className="btn btn-success">{t.save}</button>
                                            <button type="button" className="btn btn-outline" onClick={() => setShowDeviceModal(false)}>{t.cancel}</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>